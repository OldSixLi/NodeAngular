var mysql=require("mysql"),TEST_DATABASE="nodesql",TEST_TABLE="user",client=mysql.createConnection({host:"127.0.0.1",user:"root",password:"123456",port:"3306"});function resloveSql(e,n,t){let o=e;return new Promise((o,i)=>{client.query(e,n,(e,n)=>{t&&t(e,n),e?i(e):o(n)})})}function start(e){var n="INSERT INTO Answers(QuestrionId,Question,AnswerUserName,AnswerUserLink,AnswerId,DianzanCount,Detail,CreateTime) VALUES(?,?,?,?,?,?,?,NOW())",t=[e.QuestrionId,e.Question,e.AnswerUserName,e.AnswerUserLink,e.AnswerId,e.DianzanCount,e.Detail];client.query(n,t,function(n,t){n?console.log("[INSERT ERROR] - ",n.message):(console.log("~~~~~~~~~~~~~~~~~~~数据插入成功~~~~~~~~~~~~~~~~~~~~~~~"),console.log("作者：【"+e.AnswerUserName+"】,用户链接"+e.AnswerUserLink),console.log("INSERT ID:",t.insertId+",Anserid:"+e.AnswerId+" ,点赞数：【"+e.DianzanCount+"】 "),console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n"))})}function AddUser(e){let n="INSERT INTO music_users(    userid,    nickname,    weibourl,    selfword,    imgurl,    date,    level)     VALUES(?,?,?,?,?,NOW(),?)",t=[e.userid,e.nickname,e.weibourl,e.selfword,e.imgurl,e.level];return new Promise((e,o)=>{client.query(n,t,(n,t)=>{n?o(n):e("插入成功")})})}function addFollow(e){let n="INSERT INTO user_follow(    userid,    followid,followusername)     VALUES",t="",o=e.map(e=>"("+e.userID+","+e.followID+',"'+e.followUserName+'")');return params=o.join(","),new Promise((e,t)=>{client.query(n+params,null,(n,o)=>{n?t(n):e("插入成功")})})}function getFollow(){let e="select   CAST(userid AS CHAR) as source,  CAST(followid AS CHAR) as target,  followusername from user_follow   limit 0,30000";return new Promise(function(n,t){client.query(e,(e,o)=>{e?t(e):n(o)})})}function getUser(){let e="select id,userid,nickname as name ,level from music_users order by level limit 0,2000";return new Promise(function(n,t){client.query(e,(e,o)=>{e?t(e):n(o)})})}function musicPayListAdd(e){var n="select * from paylist where playid="+e.playId,t="insert  into paylist(playId,name,href,src,collectnum,createtime) values(?,?,?,?,?,NOW())",o=[e.playId,e.name,e.href,e.imgSrc,e.collectCount];client.query(n,function(n,i){n||0!=i.length?console.log(i.length+"个结果已存在"):client.query(t,o,function(n,t){n?console.log("[INSERT ERROR] - ",n.message):(console.log("~~~~~~~~~~~~~~~~~~~数据插入成功~~~~~~~~~~~~~~~~~~~~~~~"),console.log("名称："+e.name),console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n"))})})}function playList(e){var n="select DISTINCT playid from paylist";client.query(n,function(n,t){e(n?[]:t)})}function finds(e,n){if(e){var t='select * from  Answers where QuestrionId="'+e+'"';client.query(t,function(e,t){n(e?0:t.length)})}}function getEmptyCommentMusicList(e,n,t){var o,i=n,l="select id,mid,name from music where comment=0  LIMIT "+(e-1)*n+","+n;client.query(l,function(e,n){t(e?0:n)})}function getEmptyMusicList(e,n,t){var o,i=n,l="select id,mid from music where name=''  LIMIT "+(e-1)*n+","+n;client.query(l,function(e,n){t(e?0:n)})}function updateMusicName(e){let n="update  music set name=? , author=?  where id="+e.id;client.query(n,[e.name,e.author],function(t,o){if(t)return console.log("[INSERT ERROR] - ",t.message),console.log("■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■"),console.log(n),void console.log("■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■");console.log("名称："+getfullStr(e.id)+",▇▇▇▇▇▇歌曲名:"+e.name+"--"+e.author)})}function getHighQualityMusicList(e,n,t){var o="select * from music where comment>="+e+" and comment<="+n+" order by id ";client.query(o,function(e,n){t(e?0:n)})}function updateMusic(e){var n="update music set comment="+e.total+"  where id="+e.id;client.query(n,function(n,t){n?console.log("[INSERT ERROR] - ",n.message):(console.log("歌曲:《"+e.name+"》歌曲ID： "+getfullStr(e.mid)+"评论量:"+e.total+" 成功加入歌单"),console.log("_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ "))})}function getfullStr(e){for(var n=10-e.length,t="",o=0;o<n;o++)t+=" ";return e+t}function musicAdd(e){var n="insert  into music(mid,name,comment,collectid,createtime) values(?,?,?,?,NOW())",t=[e.id,e.name,e.comment,e.collectid];client.query(n,t,function(n,t){n?console.log("[INSERT ERROR] - ",n.message):console.log("歌曲ID:▇▇▇▇▇▇▇▇"+e.id)})}function deleteMusicById(e){let n="delete from music where id="+e;client.query(n,function(n,t){n?console.log("[删除失败] - ",n.message):console.log("删除歌曲ID:▇▇▇▇▇▇▇▇"+e)})}client.connect(),client.query("use "+TEST_DATABASE),module.exports={start:start,finds:finds,listAdd:musicPayListAdd,musicAdd:musicAdd,getEmptyCommentMusicList:getEmptyCommentMusicList,updateMusic:updateMusic,getHighQualityMusicList:getHighQualityMusicList,playList:playList,addUser:AddUser,addFollow:addFollow,getUser:getUser,getFollow:getFollow,resloveSql:resloveSql,getEmptyMusicList:getEmptyMusicList,updateMusicName:updateMusicName,deleteMusicById:deleteMusicById};