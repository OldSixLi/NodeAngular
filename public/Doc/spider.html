<!-- 马少博  创建于 2017年4月20日09:20:57 -->
<!DOCTYPE html>
<html lang='en'>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='shortcut icon' href='https://raw.githubusercontent.com/OldSixLi/ListPage/master/myapp/public/images/my.ico' />
    <title> 标题</title>
    <link href='http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css' rel='stylesheet'>
    <link href="https://cdn.bootcss.com/jquery-confirm/3.2.3/jquery-confirm.min.css" rel="stylesheet">
    <link href="../Style/spider.css" rel="stylesheet">
  </head>

  <body>
    <div class="container">
      <div class="input-group">
        <input type="text" class="form-control input-lg" id="questionUrl" placeholder="请输入搜索地址">
        <span class="input-group-btn">
        <button class="btn btn-primary btn-lg" type="button" onclick="beginSpider()">　开始抓取　</button>
      </span>
      </div>
      <hr>
    </div>

    <div id="container" class="once container" style="padding-top:20px;">
      <div class="box" id="imgblock2"><img src="\images\zhihu_Down\54579592\140044028--0--5a1cc56_r.jpg" class="img-responsive img-thumbnail"> </div>
      <div class="box" id="imgblock3"> </div>
      <div class="box" id="imgblock4"> </div>
      <div class="box" id="imgblock5"> </div>
      <div class="box" id="imgblock6"> </div>
      <div class="box" id="imgblock1"> </div>
    </div>
    <!-- 脚本 -->
    <script src='http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js'></script>
    <script src='http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
    <script src="https://cdn.bootcss.com/jquery-confirm/3.2.3/jquery-confirm.min.js"></script>
    <script src="../Script/webscoket/socket.io.js"></script>
    <script src="../Script/webscoket/desktopnotify.js"></script>
    <script src="../Script/webscoket/common.js"></script>
    <script>
      var chat_server = 'http://' + location.hostname + ':3001';
      console.log('server: ' + chat_server);
      var socket = io.connect(chat_server);
      var imgIndex = 1;

      //webscoket相关代码
      socket.on('mashaobo', function(data) {
        socket.emit('mashaobotest', '前台传输数据成功'); //前台传输数据
        socket.emit('FileWatch', '前台传输数据成功'); //前台传输数据
      });　

      var settime = 0,
        str = "";
      socket.on('ImgData', function(data) {
        if (data) {
          settime++;
          str = "<img src=" + data + "  class='img-responsive img-thumbnail'>";　
        }

        var yushu = settime % 6 + 1;　
        var obj = {},
          　arr = [];

        obj[$("#imgblock1").height()] = '#imgblock1';
        obj[$("#imgblock2").height()] = '#imgblock2';
        obj[$("#imgblock3").height()] = '#imgblock3';
        obj[$("#imgblock4").height()] = '#imgblock4';
        obj[$("#imgblock5").height()] = '#imgblock5';
        obj[$("#imgblock6").height()] = '#imgblock6';

        arr.push($("#imgblock1").height());
        arr.push($("#imgblock2").height());
        arr.push($("#imgblock3").height());
        arr.push($("#imgblock4").height());
        arr.push($("#imgblock5").height());
        arr.push($("#imgblock6").height());
        console.log("↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓");
        console.log('当前高度为：' + arr.join(','));
        console.log("↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑");
        var minnum = Math.min.apply(Math, arr);

        var selectors = obj[minnum];
        console.log("↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓");
        console.log("最小的是：" + selectors);
        console.log("↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑");
        $(selectors).append(str)　　
      });


      $(function() {
        document.onkeydown = function(e) {
          var ev = document.all ? window.event : e;
          if (ev.keyCode == 13) {　
            beginSpider();
          }
        }


        $("#container").on('click', 'img', function() {
          var src = $(this).attr('src');
          console.log("↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓");
          console.log(src);
          console.log("↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑");
          tool.alert("图片详情", "<img src='" + src + "' style='width:100%' class='img-responsive img-thumbnail'>");
        })
      });

      function beginSpider() {
        var word = $("#questionUrl").val();
        if (!word) {
          tool.alert("提示", "请输入内容");
        } else {
          if (word.indexOf('www.zhihu.com')) {
            word = word.substr(word.lastIndexOf('/') + 1);
          }
          socket.emit('SpiderBegin', word);
        }
      }

      //判断浏览器版本
      function myBrowser() {
        var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
        var isOpera = userAgent.indexOf("Opera") > -1; //判断是否Opera浏览器
        var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 && !isOpera; //判断是否IE浏览器
        var isFF = userAgent.indexOf("Firefox") > -1; //判断是否Firefox浏览器
        var isSafari = userAgent.indexOf("Safari") > -1; //判断是否Safari浏览器
        if (isIE) {
          var IE5 = IE55 = IE6 = IE7 = IE8 = false;
          var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
          reIE.test(userAgent);
          var fIEVersion = parseFloat(RegExp["$1"]);
          IE55 = fIEVersion == 5.5;
          IE6 = fIEVersion == 6.0;
          IE7 = fIEVersion == 7.0;
          IE8 = fIEVersion == 8.0;
          if (IE55) {
            return "IE55";
          }
          if (IE6) {
            return "IE6";
          }
          if (IE7) {
            return "IE7";
          }
          if (IE8) {
            return "IE8";
          }
        } //isIE end
        if (isFF) {
          return "FF";
        }
        if (isOpera) {
          return "Opera";
        }
      };

      var JSTOOL = function() {

        /* 弹窗 */
        this.alert = function(title, content, callback, className) {
          var confirm = callback && typeof callback === "function" ? callback :
            function() {};
          if (myBrowser() == "IE8") {

            $.alert({
              buttons: {
                ok: {
                  label: '',
                  className: 'btn-primary'
                }
              },
              message: content,
              callback: function() {
                confirm();
              },
              title: title,
            });


          } else {
            var alertClass = "";
            if (typeof className == "undefined") {
              alertClass = 'offset2 col-md-8 col-md-offset-2';
            } else {
              alertClass = className;
            }
            $.alert({
              title: title,
              content: content,
              confirm: confirm,
              confirmButton: '确定',
              backgroundDismiss: false,
              confirmButtonClass: 'btn-primary',
              animation: 'zoom',
              closeAnimation: 'scale',
              columnClass: alertClass
            });
          }
        };
        this.confirm = function(title, content, okCallback, cancelCallback) {
          var confirm = okCallback && typeof okCallback === "function" ? okCallback :
            function() {};
          var cancel = cancelCallback && typeof cancelCallback === "function" ? cancelCallback :
            function() {};
          if (myBrowser() == "IE8") {
            window.confirm({
              buttons: {
                confirm: {
                  label: '确认',
                  className: 'btn-primary'
                },
                cancel: {
                  label: '取消',
                  className: 'btn-danger'
                }
              },
              message: content,
              callback: function(result) {
                if (result) {
                  confirm();
                } else {
                  cancel();
                }
              },
              title: title,
            });
          } else {
            var confirm = okCallback && typeof okCallback === "function" ? okCallback : function() {};
            var cancel = cancelCallback && typeof cancelCallback === "function" ? cancelCallback : function() {};
            $.confirm({
              title: title,
              offsetTop: 10,
              content: content,
              confirm: confirm,
              cancel: cancel,
              confirmButton: '确定',
              cancelButton: '取消',
              confirmButtonClass: 'btn-primary',
              cancelButtonClass: 'btn-danger',
              backgroundDismiss: false,
              animation: 'zoom',
              closeAnimation: 'scale'
            });
          }
        };
        this.dialog = function(title, content) {
          window.top.$.dialog({
            title: title,
            content: content,
            animation: 'zoom',
            closeAnimation: 'scale'
          });
        };
      };
      var tool = new JSTOOL();
    </script>
  </body>

</html>